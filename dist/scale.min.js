function scale(e,t,a){function r(){var t;return t="object"==typeof a?a:!a||e.src?o:document.createElement("canvas"),t.width=d,t.height=i,t}function n(e,t){if(t){var a,r=J.getContext("2d").getImageData(0,0,d,i),n=r.data;for(a=0;ee>a;a+=4)n[a]=t[a]*te|0,n[a+1]=t[a+1]*te|0,n[a+2]=t[a+2]*te|0,n[a+3]=t[a+3]*te|0;return delete t,r}return e.getContext("2d").getImageData(0,0,d,i)}function c(e,t,a,r,n){return.5*(r-t+(2*t-5*a+4*r-n+(3*(a-r)+n-t)*e)*e)*e+a}var o;e.src?(o=document.createElement("canvas"),o.width=e.naturalWidth,o.height=e.naturalHeight,o.getContext("2d").drawImage(e,0,0)):o=e;var d,i,g,f,h,l=o.width,u=o.height,s=o.getContext("2d").getImageData(0,0,l,u).data;(e.src||!a)&&o.clearRect(0,0,l,u),"object"==typeof t?t.width?(d=t.width+.5|0,i=t.height+.5|0):(d=l*t.scaleX+.5|0,i=u*t.scaleY+.5|0):(d=t*l+.5|0,i=t*u+.5|0),g=d/l,f=i/u,h=g*f;var w,m,v,b,x,C,I,y,D,k,p,j,A,E,F,H,R,W,X,Y,q,z,B,G,J,K,L,M,N,O,P,Q,S,T,U,V=d<<2,Z=l<<2,$=0,_=0,ee=V*i,te=255.99/255;if(g>1||f>1)for(J=r(),K=n(J),L=K.data,b=0;i>b;b++)for(m=b/f,D=0|m,B=m-D,N=D*Z,M=1>D?N:N-Z,u-2>D?(O=N+Z,P=(D+2)*Z):(O=D>u-2?N:N+Z,P=O),v=0;d>v;v++,_+=4)w=v/g,y=0|w,G=w-y,S=z=y<<2,Q=1>y?S:z-4,l-2>y?(T=z+4,U=z+8):(T=y>l-2?S:z+4,U=T),W=c(B,c(G,s[M+Q],s[M+S],s[M+T],s[M+U]),c(G,s[N+Q],s[N+S],s[N+T],s[N+U]),c(G,s[O+Q],s[O+S],s[O+T],s[O+U]),c(G,s[P+Q],s[P+S],s[P+T],s[P+U]))*te|0,X=c(B,c(G,s[M+Q+1],s[M+S+1],s[M+T+1],s[M+U+1]),c(G,s[N+Q+1],s[N+S+1],s[N+T+1],s[N+U+1]),c(G,s[O+Q+1],s[O+S+1],s[O+T+1],s[O+U+1]),c(G,s[P+Q+1],s[P+S+1],s[P+T+1],s[P+U+1]))*te|0,Y=c(B,c(G,s[M+Q+2],s[M+S+2],s[M+T+2],s[M+U+2]),c(G,s[N+Q+2],s[N+S+2],s[N+T+2],s[N+U+2]),c(G,s[O+Q+2],s[O+S+2],s[O+T+2],s[O+U+2]),c(G,s[P+Q+2],s[P+S+2],s[P+T+2],s[P+U+2]))*te|0,L[_]=W>=0?256>W?W:255:0,L[_+1]=X>=0?256>X?X:255:0,L[_+2]=Y>=0?256>Y?Y:255:0,q=c(B,c(G,s[M+Q+3],s[M+S+3],s[M+T+3],s[M+U+3]),c(G,s[N+Q+3],s[N+S+3],s[N+T+3],s[N+U+3]),c(G,s[O+Q+3],s[O+S+3],s[O+T+3],s[O+U+3]),c(G,s[P+Q+3],s[P+S+3],s[P+T+3],s[P+U+3]))*te|0,L[_+3]=q>=0?256>q?q:255:0;else{if(window.Float32Array)R=new Float32Array(ee);else{R=[];for(var ae=0;ee>ae;++ae)R[ae]=0}for(m=0;u>m;m++)for(b=m*f,I=0|b,x=I*V,H=!!((I-(b+f|0))*(u-1-m))<<1,H&&(A=I+1-b,E=b+f-I-1),w=0;l>w;w++,$+=4)switch(v=w*g,C=0|v,_=x+(C<<2),F=!!((C-(v+g|0))*(l-1-w)),F&&(p=C+1-v,j=v+g-C-1),W=s[$],X=s[$+1],Y=s[$+2],q=s[$+3],F+H){case 0:R[_]+=W*h,R[_+1]+=X*h,R[_+2]+=Y*h,R[_+3]+=q*h;break;case 1:k=p*f,R[_]+=W*k,R[_+1]+=X*k,R[_+2]+=Y*k,R[_+3]+=q*k,k=j*f,R[_+4]+=W*k,R[_+5]+=X*k,R[_+6]+=Y*k,R[_+7]+=q*k;break;case 2:k=g*A,R[_]+=W*k,R[_+1]+=X*k,R[_+2]+=Y*k,R[_+3]+=q*k,k=g*E,_+=V,R[_]+=W*k,R[_+1]+=X*k,R[_+2]+=Y*k,R[_+3]+=q*k;break;default:k=p*A,R[_]+=W*k,R[_+1]+=X*k,R[_+2]+=Y*k,R[_+3]+=q*k,k=j*A,R[_+4]+=W*k,R[_+5]+=X*k,R[_+6]+=Y*k,R[_+7]+=q*k,k=p*E,_+=V,R[_]+=W*k,R[_+1]+=X*k,R[_+2]+=Y*k,R[_+3]+=q*k,k=j*E,R[_+4]+=W*k,R[_+5]+=X*k,R[_+6]+=Y*k,R[_+7]+=q*k}delete s,J=r(),K=n(J,R)}return J.getContext("2d").putImageData(K,0,0),J}