(function(){function e(e,a,r,n){function o(){var e;return e="object"==typeof r?r:a.src||n?s:document.createElement("canvas"),e.width=d,e.height=u,e}function i(e){if(e){var t,a=q.getContext("2d").getImageData(0,0,d,u),r=a.data;for(t=0;$>t;t+=4)r[t]=e[t]*_|0,r[t+1]=e[t+1]*_|0,r[t+2]=e[t+2]*_|0,r[t+3]=e[t+3]*_|0;return delete e,a}return q.getContext("2d").getImageData(0,0,d,u)}function c(e,t,a,r,n){return.5*(r-t+(2*t-5*a+4*r-n+(3*(a-r)+n-t)*e)*e)*e+a}a||(a=e.input,r=e.output,n=e.inputRemovable,e.scale&&(e=e.scale));var s;a.src?(s=document.createElement("canvas"),s.width=a.naturalWidth,s.height=a.naturalHeight,s.getContext("2d").drawImage(a,0,0)):s=a;var d,u,g=s.width,f=s.height,l=s.getContext("2d").getImageData(0,0,g,f).data;if(!g||!f)return!1;(a.src||n)&&s.clearRect(0,0,g,f),"object"==typeof e?e.width?(d=e.width+.5|0,u=e.height+.5|0):(d=g*e.scaleX+.5|0,u=f*e.scaleY+.5|0):(d=e*g+.5|0,u=e*f+.5|0);var h,p,m,v,w,x,y,b,D,I,C,j,R,k,A,E,F,L,U,H,W,X,Y,q,z,B,G,J,K,M,N,O,P,Q,S=d<<2,T=g<<2,V=0,Z=0,$=S*u,_=255.99/255,ee=d/g,te=u/f,ae=ee*te;if(ee>1||te>1)for(q=o(),z=i(),B=z.data,v=0;u>v;v++)for(p=v/te,D=0|p,X=p-D,J=D*T,G=1>D?J:J-T,f-2>D?(K=J+T,M=(D+2)*T):(K=D>f-2?J:J+T,M=K),m=0;d>m;m++,Z+=4)h=m/ee,b=0|h,Y=h-b,O=b<<2,N=1>b?O:O-4,g-2>b?(P=O+4,Q=O+8):(P=b>g-2?O:O+4,Q=P),L=c(X,c(Y,l[G+N],l[G+O],l[G+P],l[G+Q]),c(Y,l[J+N],l[J+O],l[J+P],l[J+Q]),c(Y,l[K+N],l[K+O],l[K+P],l[K+Q]),c(Y,l[M+N],l[M+O],l[M+P],l[M+Q]))*_|0,U=c(X,c(Y,l[G+N+1],l[G+O+1],l[G+P+1],l[G+Q+1]),c(Y,l[J+N+1],l[J+O+1],l[J+P+1],l[J+Q+1]),c(Y,l[K+N+1],l[K+O+1],l[K+P+1],l[K+Q+1]),c(Y,l[M+N+1],l[M+O+1],l[M+P+1],l[M+Q+1]))*_|0,H=c(X,c(Y,l[G+N+2],l[G+O+2],l[G+P+2],l[G+Q+2]),c(Y,l[J+N+2],l[J+O+2],l[J+P+2],l[J+Q+2]),c(Y,l[K+N+2],l[K+O+2],l[K+P+2],l[K+Q+2]),c(Y,l[M+N+2],l[M+O+2],l[M+P+2],l[M+Q+2]))*_|0,B[Z]=L>=0?256>L?L:255:0,B[Z+1]=U>=0?256>U?U:255:0,B[Z+2]=H>=0?256>H?H:255:0,W=c(X,c(Y,l[G+N+3],l[G+O+3],l[G+P+3],l[G+Q+3]),c(Y,l[J+N+3],l[J+O+3],l[J+P+3],l[J+Q+3]),c(Y,l[K+N+3],l[K+O+3],l[K+P+3],l[K+Q+3]),c(Y,l[M+N+3],l[M+O+3],l[M+P+3],l[M+Q+3]))*_|0,B[Z+3]=W>=0?256>W?W:255:0;else{if(t.Float32Array)F=new Float32Array($);else{F=[];for(var re=0;$>re;++re)F[re]=0}for(p=0;f>p;p++)for(v=p*te,y=0|v,w=y*S,E=!!((y-(v+te|0))*(f-1-p))<<1,E&&(R=y+1-v,k=v+te-y-1),h=0;g>h;h++,V+=4)switch(m=h*ee,x=0|m,Z=w+(x<<2),A=!!((x-(m+ee|0))*(g-1-h)),A&&(C=x+1-m,j=m+ee-x-1),L=l[V],U=l[V+1],H=l[V+2],W=l[V+3],A+E){case 0:F[Z]+=L*ae,F[Z+1]+=U*ae,F[Z+2]+=H*ae,F[Z+3]+=W*ae;break;case 1:I=C*te,F[Z]+=L*I,F[Z+1]+=U*I,F[Z+2]+=H*I,F[Z+3]+=W*I,I=j*te,F[Z+4]+=L*I,F[Z+5]+=U*I,F[Z+6]+=H*I,F[Z+7]+=W*I;break;case 2:I=ee*R,F[Z]+=L*I,F[Z+1]+=U*I,F[Z+2]+=H*I,F[Z+3]+=W*I,I=ee*k,Z+=S,F[Z]+=L*I,F[Z+1]+=U*I,F[Z+2]+=H*I,F[Z+3]+=W*I;break;default:I=C*R,F[Z]+=L*I,F[Z+1]+=U*I,F[Z+2]+=H*I,F[Z+3]+=W*I,I=j*R,F[Z+4]+=L*I,F[Z+5]+=U*I,F[Z+6]+=H*I,F[Z+7]+=W*I,I=C*k,Z+=S,F[Z]+=L*I,F[Z+1]+=U*I,F[Z+2]+=H*I,F[Z+3]+=W*I,I=j*k,F[Z+4]+=L*I,F[Z+5]+=U*I,F[Z+6]+=H*I,F[Z+7]+=W*I}delete l,q=o(),z=i(F)}if(q.getContext("2d").putImageData(z,0,0),"string"==typeof r){if("png"===r||"jpeg"===r){var ne;return ne=n&&a.src?a:new Image,ne.width=d,ne.height=u,ne.src=q.toDataURL("image/"+r,1),ne}if("png-src"===r||"jpeg-src"===r)return q.toDataURL("image/"+r.split("-")[0],1)}return q}var t=this;"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=e),exports.scale=e):t.scale=e}).call(this);