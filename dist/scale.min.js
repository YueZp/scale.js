(function(){function e(e,t,a){function r(){var t;return t="object"==typeof a?a:!a||e.src?c:document.createElement("canvas"),t.width=d,t.height=i,t}function o(e,t){if(t){var a,r=J.getContext("2d").getImageData(0,0,d,i),o=r.data;for(a=0;ee>a;a+=4)o[a]=t[a]*te|0,o[a+1]=t[a+1]*te|0,o[a+2]=t[a+2]*te|0,o[a+3]=t[a+3]*te|0;return delete t,r}return e.getContext("2d").getImageData(0,0,d,i)}function n(e,t,a,r,o){return.5*(r-t+(2*t-5*a+4*r-o+(3*(a-r)+o-t)*e)*e)*e+a}var c;e.src?(c=document.createElement("canvas"),c.width=e.naturalWidth,c.height=e.naturalHeight,c.getContext("2d").drawImage(e,0,0)):c=e;var d,i,s,l,u,g=c.width,h=c.height,f=c.getContext("2d").getImageData(0,0,g,h).data;(e.src||!a)&&c.clearRect(0,0,g,h),"object"==typeof t?t.width?(d=t.width+.5|0,i=t.height+.5|0):(d=g*t.scaleX+.5|0,i=h*t.scaleY+.5|0):(d=t*g+.5|0,i=t*h+.5|0),s=d/g,l=i/h,u=s*l;var m,w,x,p,v,b,C,I,y,D,k,j,A,E,F,H,R,W,X,Y,q,z,B,G,J,K,L,M,N,O,P,Q,S,T,U,V=d<<2,Z=g<<2,$=0,_=0,ee=V*i,te=255.99/255;if(s>1||l>1)for(J=r(),K=o(J),L=K.data,p=0;i>p;p++)for(w=p/l,y=0|w,B=w-y,N=y*Z,M=1>y?N:N-Z,h-2>y?(O=N+Z,P=(y+2)*Z):(O=y>h-2?N:N+Z,P=O),x=0;d>x;x++,_+=4)m=x/s,I=0|m,G=m-I,S=z=I<<2,Q=1>I?S:z-4,g-2>I?(T=z+4,U=z+8):(T=I>g-2?S:z+4,U=T),W=n(B,n(G,f[M+Q],f[M+S],f[M+T],f[M+U]),n(G,f[N+Q],f[N+S],f[N+T],f[N+U]),n(G,f[O+Q],f[O+S],f[O+T],f[O+U]),n(G,f[P+Q],f[P+S],f[P+T],f[P+U]))*te|0,X=n(B,n(G,f[M+Q+1],f[M+S+1],f[M+T+1],f[M+U+1]),n(G,f[N+Q+1],f[N+S+1],f[N+T+1],f[N+U+1]),n(G,f[O+Q+1],f[O+S+1],f[O+T+1],f[O+U+1]),n(G,f[P+Q+1],f[P+S+1],f[P+T+1],f[P+U+1]))*te|0,Y=n(B,n(G,f[M+Q+2],f[M+S+2],f[M+T+2],f[M+U+2]),n(G,f[N+Q+2],f[N+S+2],f[N+T+2],f[N+U+2]),n(G,f[O+Q+2],f[O+S+2],f[O+T+2],f[O+U+2]),n(G,f[P+Q+2],f[P+S+2],f[P+T+2],f[P+U+2]))*te|0,L[_]=W>=0?256>W?W:255:0,L[_+1]=X>=0?256>X?X:255:0,L[_+2]=Y>=0?256>Y?Y:255:0,q=n(B,n(G,f[M+Q+3],f[M+S+3],f[M+T+3],f[M+U+3]),n(G,f[N+Q+3],f[N+S+3],f[N+T+3],f[N+U+3]),n(G,f[O+Q+3],f[O+S+3],f[O+T+3],f[O+U+3]),n(G,f[P+Q+3],f[P+S+3],f[P+T+3],f[P+U+3]))*te|0,L[_+3]=q>=0?256>q?q:255:0;else{if(window.Float32Array)R=new Float32Array(ee);else{R=[];for(var ae=0;ee>ae;++ae)R[ae]=0}for(w=0;h>w;w++)for(p=w*l,C=0|p,v=C*V,H=!!((C-(p+l|0))*(h-1-w))<<1,H&&(A=C+1-p,E=p+l-C-1),m=0;g>m;m++,$+=4)switch(x=m*s,b=0|x,_=v+(b<<2),F=!!((b-(x+s|0))*(g-1-m)),F&&(k=b+1-x,j=x+s-b-1),W=f[$],X=f[$+1],Y=f[$+2],q=f[$+3],F+H){case 0:R[_]+=W*u,R[_+1]+=X*u,R[_+2]+=Y*u,R[_+3]+=q*u;break;case 1:D=k*l,R[_]+=W*D,R[_+1]+=X*D,R[_+2]+=Y*D,R[_+3]+=q*D,D=j*l,R[_+4]+=W*D,R[_+5]+=X*D,R[_+6]+=Y*D,R[_+7]+=q*D;break;case 2:D=s*A,R[_]+=W*D,R[_+1]+=X*D,R[_+2]+=Y*D,R[_+3]+=q*D,D=s*E,_+=V,R[_]+=W*D,R[_+1]+=X*D,R[_+2]+=Y*D,R[_+3]+=q*D;break;default:D=k*A,R[_]+=W*D,R[_+1]+=X*D,R[_+2]+=Y*D,R[_+3]+=q*D,D=j*A,R[_+4]+=W*D,R[_+5]+=X*D,R[_+6]+=Y*D,R[_+7]+=q*D,D=k*E,_+=V,R[_]+=W*D,R[_+1]+=X*D,R[_+2]+=Y*D,R[_+3]+=q*D,D=j*E,R[_+4]+=W*D,R[_+5]+=X*D,R[_+6]+=Y*D,R[_+7]+=q*D}delete f,J=r(),K=o(J,R)}return J.getContext("2d").putImageData(K,0,0),J}exports?(module&&module.exports&&(exports=module.exports=e),exports.scale=e):this.scale=e}).call(this);