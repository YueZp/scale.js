(function(){function e(e,a,r,n){function i(){z="object"==typeof r?r:a.src||n?s:document.createElement("canvas"),z.width=f,z.height=d,B=z.getContext("2d")}function o(e){if(e){var t,a=B.getImageData(0,0,f,d),r=a.data;for(t=0;ee>t;t+=4)r[t]=e[t]*te|0,r[t+1]=e[t+1]*te|0,r[t+2]=e[t+2]*te|0,r[t+3]=e[t+3]*te|0;return delete e,a}return B.getImageData(0,0,f,d)}function c(e,t,a,r,n){return.5*(r-t+(2*t-5*a+4*r-n+(3*(a-r)+n-t)*e)*e)*e+a}a||(a=e.input,r=e.output,n=e.inputRemovable,e.scale&&(e=e.scale));var s,u;a.src?(s=document.createElement("canvas"),s.width=a.naturalWidth,s.height=a.naturalHeight):s=a,u=s.getContext("2d"),a.src&&u.drawImage(a,0,0);var f,d,l=s.width,g=s.height,h=u.getImageData(0,0,l,g).data;if(!l||!g)return!1;(a.src||n)&&s.clearRect(0,0,l,g),"object"==typeof e?e.width?(f=e.width+.5|0,d=e.height+.5|0):(f=l*e.scaleX+.5|0,d=g*e.scaleY+.5|0):(f=e*l+.5|0,d=e*g+.5|0);var p,m,w,v,x,y,b,D,I,j,R,k,A,C,E,F,L,U,H,W,X,Y,q,z,B,G,J,K,M,N,O,P,Q,S,T,V=f<<2,Z=l<<2,$=0,_=0,ee=V*d,te=255.99/255,ae=f/l,re=d/g,ne=ae*re;if(ae>1||re>1)for(i(),G=o(),J=G.data,v=0;d>v;v++)for(m=v/re,I=0|m,Y=m-I,M=I*Z,K=1>I?M:M-Z,g-2>I?(N=M+Z,O=(I+2)*Z):N=O=I>g-2?M:M+Z,w=0;f>w;w++,_+=4)p=w/ae,D=0|p,q=p-D,Q=D<<2,P=1>D?Q:Q-4,l-2>D?(S=Q+4,T=Q+8):S=T=D>l-2?Q:Q+4,U=c(Y,c(q,h[K+P],h[K+Q],h[K+S],h[K+T]),c(q,h[M+P],h[M+Q],h[M+S],h[M+T]),c(q,h[N+P],h[N+Q],h[N+S],h[N+T]),c(q,h[O+P],h[O+Q],h[O+S],h[O+T]))*te|0,++P,++Q,++S,++T,H=c(Y,c(q,h[K+P],h[K+Q],h[K+S],h[K+T]),c(q,h[M+P],h[M+Q],h[M+S],h[M+T]),c(q,h[N+P],h[N+Q],h[N+S],h[N+T]),c(q,h[O+P],h[O+Q],h[O+S],h[O+T]))*te|0,++P,++Q,++S,++T,W=c(Y,c(q,h[K+P],h[K+Q],h[K+S],h[K+T]),c(q,h[M+P],h[M+Q],h[M+S],h[M+T]),c(q,h[N+P],h[N+Q],h[N+S],h[N+T]),c(q,h[O+P],h[O+Q],h[O+S],h[O+T]))*te|0,J[_]=U>=0?256>U?U:255:0,J[_+1]=H>=0?256>H?H:255:0,J[_+2]=W>=0?256>W?W:255:0,++P,++Q,++S,++T,X=c(Y,c(q,h[K+P],h[K+Q],h[K+S],h[K+T]),c(q,h[M+P],h[M+Q],h[M+S],h[M+T]),c(q,h[N+P],h[N+Q],h[N+S],h[N+T]),c(q,h[O+P],h[O+Q],h[O+S],h[O+T]))*te|0,J[_+3]=X>=0?256>X?X:255:0;else{if(t.Float32Array)L=new Float32Array(ee);else for(L=[],_=0;ee>_;++_)L[_]=0;for(m=0;g>m;m++)for(v=m*re,b=0|v,x=b*V,F=!!((b-(v+re|0))*(g-1-m))<<1,F&&(A=b+1-v,C=v+re-b-1),p=0;l>p;p++,$+=4)switch(w=p*ae,y=0|w,_=x+(y<<2),E=!!((y-(w+ae|0))*(l-1-p)),E&&(R=y+1-w,k=w+ae-y-1),U=h[$],H=h[$+1],W=h[$+2],X=h[$+3],E+F){case 0:L[_]+=U*ne,L[_+1]+=H*ne,L[_+2]+=W*ne,L[_+3]+=X*ne;break;case 1:j=R*re,L[_]+=U*j,L[_+1]+=H*j,L[_+2]+=W*j,L[_+3]+=X*j,j=k*re,L[_+4]+=U*j,L[_+5]+=H*j,L[_+6]+=W*j,L[_+7]+=X*j;break;case 2:j=ae*A,L[_]+=U*j,L[_+1]+=H*j,L[_+2]+=W*j,L[_+3]+=X*j,j=ae*C,_+=V,L[_]+=U*j,L[_+1]+=H*j,L[_+2]+=W*j,L[_+3]+=X*j;break;default:j=R*A,L[_]+=U*j,L[_+1]+=H*j,L[_+2]+=W*j,L[_+3]+=X*j,j=k*A,L[_+4]+=U*j,L[_+5]+=H*j,L[_+6]+=W*j,L[_+7]+=X*j,j=R*C,_+=V,L[_]+=U*j,L[_+1]+=H*j,L[_+2]+=W*j,L[_+3]+=X*j,j=k*C,L[_+4]+=U*j,L[_+5]+=H*j,L[_+6]+=W*j,L[_+7]+=X*j}delete h,i(),G=o(L)}if(B.putImageData(G,0,0),"string"==typeof r){if("png"===r||"jpeg"===r){var ie;return ie=n&&a.src?a:new Image,ie.width=f,ie.height=d,ie.src=z.toDataURL("image/"+r,1),ie}if("png-src"===r||"jpeg-src"===r)return z.toDataURL("image/"+r.split("-")[0],1)}return z}var t=this;"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=e),exports.scale=e):t.scale=e}).call(this);