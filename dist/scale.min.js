(function(){function e(e,t,a){function r(){var t;return t="object"==typeof a?a:!a||e.src?d:document.createElement("canvas"),t.width=c,t.height=i,t}function o(e,t){if(t){var a,r=J.getContext("2d").getImageData(0,0,c,i),o=r.data;for(a=0;ee>a;a+=4)o[a]=t[a]*te|0,o[a+1]=t[a+1]*te|0,o[a+2]=t[a+2]*te|0,o[a+3]=t[a+3]*te|0;return delete t,r}return e.getContext("2d").getImageData(0,0,c,i)}function n(e,t,a,r,o){return.5*(r-t+(2*t-5*a+4*r-o+(3*(a-r)+o-t)*e)*e)*e+a}var d;e.src?(d=document.createElement("canvas"),d.width=e.naturalWidth,d.height=e.naturalHeight,d.getContext("2d").drawImage(e,0,0)):d=e;var c,i,s,f,l,u=d.width,g=d.height,h=d.getContext("2d").getImageData(0,0,u,g).data;(e.src||!a)&&d.clearRect(0,0,u,g),"object"==typeof t?t.width?(c=t.width+.5|0,i=t.height+.5|0):(c=u*t.scaleX+.5|0,i=g*t.scaleY+.5|0):(c=t*u+.5|0,i=t*g+.5|0),s=c/u,f=i/g,l=s*f;var m,p,w,x,v,y,b,C,I,D,k,j,A,E,F,H,R,W,X,Y,q,z,B,G,J,K,L,M,N,O,P,Q,S,T,U,V=c<<2,Z=u<<2,$=0,_=0,ee=V*i,te=255.99/255;if(s>1||f>1)for(J=r(),K=o(J),L=K.data,x=0;i>x;x++)for(p=x/f,I=0|p,B=p-I,N=I*Z,M=1>I?N:N-Z,g-2>I?(O=N+Z,P=(I+2)*Z):(O=I>g-2?N:N+Z,P=O),w=0;c>w;w++,_+=4)m=w/s,C=0|m,G=m-C,S=z=C<<2,Q=1>C?S:z-4,u-2>C?(T=z+4,U=z+8):(T=C>u-2?S:z+4,U=T),W=n(B,n(G,h[M+Q],h[M+S],h[M+T],h[M+U]),n(G,h[N+Q],h[N+S],h[N+T],h[N+U]),n(G,h[O+Q],h[O+S],h[O+T],h[O+U]),n(G,h[P+Q],h[P+S],h[P+T],h[P+U]))*te|0,X=n(B,n(G,h[M+Q+1],h[M+S+1],h[M+T+1],h[M+U+1]),n(G,h[N+Q+1],h[N+S+1],h[N+T+1],h[N+U+1]),n(G,h[O+Q+1],h[O+S+1],h[O+T+1],h[O+U+1]),n(G,h[P+Q+1],h[P+S+1],h[P+T+1],h[P+U+1]))*te|0,Y=n(B,n(G,h[M+Q+2],h[M+S+2],h[M+T+2],h[M+U+2]),n(G,h[N+Q+2],h[N+S+2],h[N+T+2],h[N+U+2]),n(G,h[O+Q+2],h[O+S+2],h[O+T+2],h[O+U+2]),n(G,h[P+Q+2],h[P+S+2],h[P+T+2],h[P+U+2]))*te|0,L[_]=W>=0?256>W?W:255:0,L[_+1]=X>=0?256>X?X:255:0,L[_+2]=Y>=0?256>Y?Y:255:0,q=n(B,n(G,h[M+Q+3],h[M+S+3],h[M+T+3],h[M+U+3]),n(G,h[N+Q+3],h[N+S+3],h[N+T+3],h[N+U+3]),n(G,h[O+Q+3],h[O+S+3],h[O+T+3],h[O+U+3]),n(G,h[P+Q+3],h[P+S+3],h[P+T+3],h[P+U+3]))*te|0,L[_+3]=q>=0?256>q?q:255:0;else{if(window.Float32Array)R=new Float32Array(ee);else{R=[];for(var ae=0;ee>ae;++ae)R[ae]=0}for(p=0;g>p;p++)for(x=p*f,b=0|x,v=b*V,H=!!((b-(x+f|0))*(g-1-p))<<1,H&&(A=b+1-x,E=x+f-b-1),m=0;u>m;m++,$+=4)switch(w=m*s,y=0|w,_=v+(y<<2),F=!!((y-(w+s|0))*(u-1-m)),F&&(k=y+1-w,j=w+s-y-1),W=h[$],X=h[$+1],Y=h[$+2],q=h[$+3],F+H){case 0:R[_]+=W*l,R[_+1]+=X*l,R[_+2]+=Y*l,R[_+3]+=q*l;break;case 1:D=k*f,R[_]+=W*D,R[_+1]+=X*D,R[_+2]+=Y*D,R[_+3]+=q*D,D=j*f,R[_+4]+=W*D,R[_+5]+=X*D,R[_+6]+=Y*D,R[_+7]+=q*D;break;case 2:D=s*A,R[_]+=W*D,R[_+1]+=X*D,R[_+2]+=Y*D,R[_+3]+=q*D,D=s*E,_+=V,R[_]+=W*D,R[_+1]+=X*D,R[_+2]+=Y*D,R[_+3]+=q*D;break;default:D=k*A,R[_]+=W*D,R[_+1]+=X*D,R[_+2]+=Y*D,R[_+3]+=q*D,D=j*A,R[_+4]+=W*D,R[_+5]+=X*D,R[_+6]+=Y*D,R[_+7]+=q*D,D=k*E,_+=V,R[_]+=W*D,R[_+1]+=X*D,R[_+2]+=Y*D,R[_+3]+=q*D,D=j*E,R[_+4]+=W*D,R[_+5]+=X*D,R[_+6]+=Y*D,R[_+7]+=q*D}delete h,J=r(),K=o(J,R)}return J.getContext("2d").putImageData(K,0,0),J}"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=e),exports.scale=e):this.scale=e}).call(this);