(function(){function e(e,a,r,n){function o(){var e;return e="object"==typeof r?r:a.src||n?s:document.createElement("canvas"),e.width=d,e.height=f,e}function i(e){if(e){var t,a=z.getContext("2d").getImageData(0,0,d,f),r=a.data;for(t=0;_>t;t+=4)r[t]=e[t]*ee|0,r[t+1]=e[t+1]*ee|0,r[t+2]=e[t+2]*ee|0,r[t+3]=e[t+3]*ee|0;return delete e,a}return z.getContext("2d").getImageData(0,0,d,f)}function c(e,t,a,r,n){return.5*(r-t+(2*t-5*a+4*r-n+(3*(a-r)+n-t)*e)*e)*e+a}a||(a=e.input,r=e.output,n=e.inputRemovable,e.scale&&(e=e.scale));var s,u;a.src&&(s=document.createElement("canvas"),s.width=a.naturalWidth,s.height=a.naturalHeight),u=s.getContext("2d"),a.src&&u.drawImage(a,0,0);var d,f,g=s.width,l=s.height,h=u.getImageData(0,0,g,l).data;if(!g||!l)return!1;(a.src||n)&&s.clearRect(0,0,g,l),"object"==typeof e?e.width?(d=e.width+.5|0,f=e.height+.5|0):(d=g*e.scaleX+.5|0,f=l*e.scaleY+.5|0):(d=e*g+.5|0,f=e*l+.5|0);var p,m,v,w,x,y,b,D,I,j,C,R,k,A,E,F,L,U,H,W,X,Y,q,z,B,G,J,K,M,N,O,P,Q,S,T=d<<2,V=g<<2,Z=0,$=0,_=T*f,ee=255.99/255,te=d/g,ae=f/l,re=te*ae;if(te>1||ae>1)for(z=o(),B=i(),G=B.data,w=0;f>w;w++)for(m=w/ae,I=0|m,Y=m-I,K=I*V,J=1>I?K:K-V,l-2>I?(M=K+V,N=(I+2)*V):M=N=I>l-2?K:K+V,v=0;d>v;v++,$+=4)p=v/te,D=0|p,q=p-D,P=D<<2,O=1>D?P:P-4,g-2>D?(Q=P+4,S=P+8):Q=S=D>g-2?P:P+4,U=c(Y,c(q,h[J+O],h[J+P],h[J+Q],h[J+S]),c(q,h[K+O],h[K+P],h[K+Q],h[K+S]),c(q,h[M+O],h[M+P],h[M+Q],h[M+S]),c(q,h[N+O],h[N+P],h[N+Q],h[N+S]))*ee|0,++O,++P,++Q,++S,H=c(Y,c(q,h[J+O],h[J+P],h[J+Q],h[J+S]),c(q,h[K+O],h[K+P],h[K+Q],h[K+S]),c(q,h[M+O],h[M+P],h[M+Q],h[M+S]),c(q,h[N+O],h[N+P],h[N+Q],h[N+S]))*ee|0,++O,++P,++Q,++S,W=c(Y,c(q,h[J+O],h[J+P],h[J+Q],h[J+S]),c(q,h[K+O],h[K+P],h[K+Q],h[K+S]),c(q,h[M+O],h[M+P],h[M+Q],h[M+S]),c(q,h[N+O],h[N+P],h[N+Q],h[N+S]))*ee|0,G[$]=U>=0?256>U?U:255:0,G[$+1]=H>=0?256>H?H:255:0,G[$+2]=W>=0?256>W?W:255:0,++O,++P,++Q,++S,X=c(Y,c(q,h[J+O],h[J+P],h[J+Q],h[J+S]),c(q,h[K+O],h[K+P],h[K+Q],h[K+S]),c(q,h[M+O],h[M+P],h[M+Q],h[M+S]),c(q,h[N+O],h[N+P],h[N+Q],h[N+S]))*ee|0,G[$+3]=X>=0?256>X?X:255:0;else{if(t.Float32Array)L=new Float32Array(_);else{L=[];for(var ne=0;_>ne;++ne)L[ne]=0}for(m=0;l>m;m++)for(w=m*ae,b=0|w,x=b*T,F=!!((b-(w+ae|0))*(l-1-m))<<1,F&&(k=b+1-w,A=w+ae-b-1),p=0;g>p;p++,Z+=4)switch(v=p*te,y=0|v,$=x+(y<<2),E=!!((y-(v+te|0))*(g-1-p)),E&&(C=y+1-v,R=v+te-y-1),U=h[Z],H=h[Z+1],W=h[Z+2],X=h[Z+3],E+F){case 0:L[$]+=U*re,L[$+1]+=H*re,L[$+2]+=W*re,L[$+3]+=X*re;break;case 1:j=C*ae,L[$]+=U*j,L[$+1]+=H*j,L[$+2]+=W*j,L[$+3]+=X*j,j=R*ae,L[$+4]+=U*j,L[$+5]+=H*j,L[$+6]+=W*j,L[$+7]+=X*j;break;case 2:j=te*k,L[$]+=U*j,L[$+1]+=H*j,L[$+2]+=W*j,L[$+3]+=X*j,j=te*A,$+=T,L[$]+=U*j,L[$+1]+=H*j,L[$+2]+=W*j,L[$+3]+=X*j;break;default:j=C*k,L[$]+=U*j,L[$+1]+=H*j,L[$+2]+=W*j,L[$+3]+=X*j,j=R*k,L[$+4]+=U*j,L[$+5]+=H*j,L[$+6]+=W*j,L[$+7]+=X*j,j=C*A,$+=T,L[$]+=U*j,L[$+1]+=H*j,L[$+2]+=W*j,L[$+3]+=X*j,j=R*A,L[$+4]+=U*j,L[$+5]+=H*j,L[$+6]+=W*j,L[$+7]+=X*j}delete h,z=o(),B=i(L)}if(z.getContext("2d").putImageData(B,0,0),"string"==typeof r){if("png"===r||"jpeg"===r){var oe;return oe=n&&a.src?a:new Image,oe.width=d,oe.height=f,oe.src=z.toDataURL("image/"+r,1),oe}if("png-src"===r||"jpeg-src"===r)return z.toDataURL("image/"+r.split("-")[0],1)}return z}var t=this;"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=e),exports.scale=e):t.scale=e}).call(this);