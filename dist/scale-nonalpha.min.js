(function(){function t(t,a,i,r){function h(){(z="object"==typeof i?i:a.src||r?o:document.createElement("canvas")).width=g,z.height=s,B=z.getContext("2d")}function n(t){if(t){var e,a=B.getImageData(0,0,g,s),i=a.data;for(e=0;e<et;e+=4)i[e]=t[e]*at|0,i[e+1]=t[e+1]*at|0,i[e+2]=t[e+2]*at|0,i[e+3]=255;return delete t,a}return B.getImageData(0,0,g,s)}a||(a=t.input,i=t.output,r=t.inputRemovable,t.scale&&(t=t.scale));var o,u;if(a.src)if(o=document.createElement("canvas"),null!=a.naturalWidth)o.width=a.naturalWidth,o.height=a.naturalHeight;else if(null!=a.runtimeStyle){var d=a.runtimeStyle,l=d.width,c=d.height;d.width="auto",d.height="auto",o.width=a.width,o.height=a.height,d.width=l,d.height=c}else{l=a.width,c=a.height;a.removeAttribute&&(a.removeAttribute("width"),a.removeAttribute("height")),o.width=a.width,o.height=a.height,a.width=l,a.height=c}else o=a;u=o.getContext("2d"),a.src&&u.drawImage(a,0,0);var g,s,f=o.width,m=o.height,w=u.getImageData(0,0,f,m).data;if(!f||!m)return!1;(a.src||r)&&u.clearRect(0,0,f,m),"object"==typeof t?t.width?(g=t.width+.5|0,s=t.height+.5|0):(g=f*t.scaleX+.5|0,s=m*t.scaleY+.5|0):(g=t*f+.5|0,s=t*m+.5|0);var p,v,b,y,x,D,I,A,j,R,k,C,E,F,L,S,U,W,H,X,Y,q,z,B,G,J,K,M,N,O,P,Q,T,V,Z=g<<2,$=f<<2,_=0,tt=0,et=Z*s,at=255.99/255,it=g/f,rt=s/m,ht=it*rt;if(it>1||rt>1){function nt(t,e,a,i,r){return.5*(i-e+(2*e-5*a+4*i-r+(3*(a-i)+r-e)*t)*t)*t+a}for(h(),J=(G=n()).data,y=0;y<s;y++)for(Y=(v=y/rt)-(j=0|v),M=j*$,K=j<1?M:M-$,j<m-2?(N=M+$,O=(j+2)*$):N=O=j>m-2?M:M+$,b=0;b<g;b++,tt+=4)q=(p=b/it)-(A=0|p),Q=A<<2,P=A<1?Q:Q-4,A<f-2?(T=Q+4,V=Q+8):T=V=A>f-2?Q:Q+4,W=nt(Y,nt(q,w[K+P],w[K+Q],w[K+T],w[K+V]),nt(q,w[M+P],w[M+Q],w[M+T],w[M+V]),nt(q,w[N+P],w[N+Q],w[N+T],w[N+V]),nt(q,w[O+P],w[O+Q],w[O+T],w[O+V]))*at|0,++Q,++T,++V,H=nt(Y,nt(q,w[K+ ++P],w[K+Q],w[K+T],w[K+V]),nt(q,w[M+P],w[M+Q],w[M+T],w[M+V]),nt(q,w[N+P],w[N+Q],w[N+T],w[N+V]),nt(q,w[O+P],w[O+Q],w[O+T],w[O+V]))*at|0,++Q,++T,++V,X=nt(Y,nt(q,w[K+ ++P],w[K+Q],w[K+T],w[K+V]),nt(q,w[M+P],w[M+Q],w[M+T],w[M+V]),nt(q,w[N+P],w[N+Q],w[N+T],w[N+V]),nt(q,w[O+P],w[O+Q],w[O+T],w[O+V]))*at|0,J[tt]=W>=0?W<256?W:255:0,J[tt+1]=H>=0?H<256?H:255:0,J[tt+2]=X>=0?X<256?X:255:0,J[tt+3]=255}else{if(e.Float32Array)U=new Float32Array(et);else for(U=[],tt=0;tt<et;++tt)U[tt]=0;for(v=0;v<m;v++)for(x=(I=0|(y=v*rt))*Z,(S=!!((I-(y+rt|0))*(m-1-v))<<1)&&(E=I+1-y,F=y+rt-I-1),p=0;p<f;p++,_+=4)switch(b=p*it,D=0|b,tt=x+(D<<2),(L=!!((D-(b+it|0))*(f-1-p)))&&(k=D+1-b,C=b+it-D-1),W=w[_],H=w[_+1],X=w[_+2],L+S){case 0:U[tt]+=W*ht,U[tt+1]+=H*ht,U[tt+2]+=X*ht;break;case 1:R=k*rt,U[tt]+=W*R,U[tt+1]+=H*R,U[tt+2]+=X*R,R=C*rt,U[tt+4]+=W*R,U[tt+5]+=H*R,U[tt+6]+=X*R;break;case 2:R=it*E,U[tt]+=W*R,U[tt+1]+=H*R,U[tt+2]+=X*R,R=it*F,U[tt+=Z]+=W*R,U[tt+1]+=H*R,U[tt+2]+=X*R;break;default:R=k*E,U[tt]+=W*R,U[tt+1]+=H*R,U[tt+2]+=X*R,R=C*E,U[tt+4]+=W*R,U[tt+5]+=H*R,U[tt+6]+=X*R,R=k*F,U[tt+=Z]+=W*R,U[tt+1]+=H*R,U[tt+2]+=X*R,R=C*F,U[tt+4]+=W*R,U[tt+5]+=H*R,U[tt+6]+=X*R}delete w,h(),G=n(U)}if(B.putImageData(G,0,0),"string"==typeof i){if("png"===i||"jpeg"===i){var ot;return ot=r&&a.src?a:new Image,ot.width=g,ot.height=s,ot.src=z.toDataURL("image/"+i,1),ot}if("png-src"===i||"jpeg-src"===i)return z.toDataURL("image/"+i.split("-")[0],1)}return z}var e=this;"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=t),exports.scale=t):e.scale=t}).call(this);