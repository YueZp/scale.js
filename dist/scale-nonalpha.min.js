(function(){function e(e,t,a){function r(){var t;return t="object"==typeof a?a:!a||e.src?d:document.createElement("canvas"),t.width=c,t.height=i,t}function o(e,t){if(t){var a,r=G.getContext("2d").getImageData(0,0,c,i),o=r.data;for(a=0;_>a;a+=4)o[a]=t[a]*ee|0,o[a+1]=t[a+1]*ee|0,o[a+2]=t[a+2]*ee|0,o[a+3]=255;return delete t,r}return e.getContext("2d").getImageData(0,0,c,i)}function n(e,t,a,r,o){return.5*(r-t+(2*t-5*a+4*r-o+(3*(a-r)+o-t)*e)*e)*e+a}var d;e.src?(d=document.createElement("canvas"),d.width=e.naturalWidth,d.height=e.naturalHeight,d.getContext("2d").drawImage(e,0,0)):d=e;var c,i,s,f,l,u=d.width,g=d.height,h=d.getContext("2d").getImageData(0,0,u,g).data;(e.src||!a)&&d.clearRect(0,0,u,g),"object"==typeof t?t.width?(c=t.width+.5|0,i=t.height+.5|0):(c=u*t.scaleX+.5|0,i=g*t.scaleY+.5|0):(c=t*u+.5|0,i=t*g+.5|0),s=c/u,f=i/g,l=s*f;var m,p,w,x,v,y,b,C,I,D,k,j,A,E,F,H,R,W,X,Y,q,z,B,G,J,K,L,M,N,O,P,Q,S,T,U=c<<2,V=u<<2,Z=0,$=0,_=U*i,ee=255.99/255;if(s>1||f>1)for(G=r(),J=o(G),K=J.data,x=0;i>x;x++)for(p=x/f,I=0|p,z=p-I,M=I*V,L=1>I?M:M-V,g-2>I?(N=M+V,O=(I+2)*V):(N=I>g-2?M:M+V,O=N),w=0;c>w;w++,$+=4)m=w/s,C=0|m,B=m-C,Q=q=C<<2,P=1>C?Q:q-4,u-2>C?(S=q+4,T=q+8):(S=C>u-2?Q:q+4,T=S),W=n(z,n(B,h[L+P],h[L+Q],h[L+S],h[L+T]),n(B,h[M+P],h[M+Q],h[M+S],h[M+T]),n(B,h[N+P],h[N+Q],h[N+S],h[N+T]),n(B,h[O+P],h[O+Q],h[O+S],h[O+T]))*ee|0,X=n(z,n(B,h[L+P+1],h[L+Q+1],h[L+S+1],h[L+T+1]),n(B,h[M+P+1],h[M+Q+1],h[M+S+1],h[M+T+1]),n(B,h[N+P+1],h[N+Q+1],h[N+S+1],h[N+T+1]),n(B,h[O+P+1],h[O+Q+1],h[O+S+1],h[O+T+1]))*ee|0,Y=n(z,n(B,h[L+P+2],h[L+Q+2],h[L+S+2],h[L+T+2]),n(B,h[M+P+2],h[M+Q+2],h[M+S+2],h[M+T+2]),n(B,h[N+P+2],h[N+Q+2],h[N+S+2],h[N+T+2]),n(B,h[O+P+2],h[O+Q+2],h[O+S+2],h[O+T+2]))*ee|0,K[$]=W>=0?256>W?W:255:0,K[$+1]=X>=0?256>X?X:255:0,K[$+2]=Y>=0?256>Y?Y:255:0,K[$+3]=255;else{if(window.Float32Array)R=new Float32Array(_);else{R=[];for(var te=0;_>te;++te)R[te]=0}for(p=0;g>p;p++)for(x=p*f,b=0|x,v=b*U,H=!!((b-(x+f|0))*(g-1-p))<<1,H&&(A=b+1-x,E=x+f-b-1),m=0;u>m;m++,Z+=4)switch(w=m*s,y=0|w,$=v+(y<<2),F=!!((y-(w+s|0))*(u-1-m)),F&&(k=y+1-w,j=w+s-y-1),W=h[Z],X=h[Z+1],Y=h[Z+2],F+H){case 0:R[$]+=W*l,R[$+1]+=X*l,R[$+2]+=Y*l;break;case 1:D=k*f,R[$]+=W*D,R[$+1]+=X*D,R[$+2]+=Y*D,D=j*f,R[$+4]+=W*D,R[$+5]+=X*D,R[$+6]+=Y*D;break;case 2:D=s*A,R[$]+=W*D,R[$+1]+=X*D,R[$+2]+=Y*D,D=s*E,$+=U,R[$]+=W*D,R[$+1]+=X*D,R[$+2]+=Y*D;break;default:D=k*A,R[$]+=W*D,R[$+1]+=X*D,R[$+2]+=Y*D,D=j*A,R[$+4]+=W*D,R[$+5]+=X*D,R[$+6]+=Y*D,D=k*E,$+=U,R[$]+=W*D,R[$+1]+=X*D,R[$+2]+=Y*D,D=j*E,R[$+4]+=W*D,R[$+5]+=X*D,R[$+6]+=Y*D}delete h,G=r(),J=o(G,R)}return G.getContext("2d").putImageData(J,0,0),G}"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=e),exports.scale=e):this.scale=e}).call(this);