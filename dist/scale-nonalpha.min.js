(function(){function e(e,t,a){function r(){var t;return t="object"==typeof a?a:!a||e.src?c:document.createElement("canvas"),t.width=d,t.height=i,t}function o(e,t){if(t){var a,r=G.getContext("2d").getImageData(0,0,d,i),o=r.data;for(a=0;_>a;a+=4)o[a]=t[a]*ee|0,o[a+1]=t[a+1]*ee|0,o[a+2]=t[a+2]*ee|0,o[a+3]=255;return delete t,r}return e.getContext("2d").getImageData(0,0,d,i)}function n(e,t,a,r,o){return.5*(r-t+(2*t-5*a+4*r-o+(3*(a-r)+o-t)*e)*e)*e+a}var c;e.src?(c=document.createElement("canvas"),c.width=e.naturalWidth,c.height=e.naturalHeight,c.getContext("2d").drawImage(e,0,0)):c=e;var d,i,s,l,u,g=c.width,h=c.height,f=c.getContext("2d").getImageData(0,0,g,h).data;(e.src||!a)&&c.clearRect(0,0,g,h),"object"==typeof t?t.width?(d=t.width+.5|0,i=t.height+.5|0):(d=g*t.scaleX+.5|0,i=h*t.scaleY+.5|0):(d=t*g+.5|0,i=t*h+.5|0),s=d/g,l=i/h,u=s*l;var m,w,x,p,v,b,C,I,y,D,k,j,A,E,F,H,R,W,X,Y,q,z,B,G,J,K,L,M,N,O,P,Q,S,T,U=d<<2,V=g<<2,Z=0,$=0,_=U*i,ee=255.99/255;if(s>1||l>1)for(G=r(),J=o(G),K=J.data,p=0;i>p;p++)for(w=p/l,y=0|w,z=w-y,M=y*V,L=1>y?M:M-V,h-2>y?(N=M+V,O=(y+2)*V):(N=y>h-2?M:M+V,O=N),x=0;d>x;x++,$+=4)m=x/s,I=0|m,B=m-I,Q=q=I<<2,P=1>I?Q:q-4,g-2>I?(S=q+4,T=q+8):(S=I>g-2?Q:q+4,T=S),W=n(z,n(B,f[L+P],f[L+Q],f[L+S],f[L+T]),n(B,f[M+P],f[M+Q],f[M+S],f[M+T]),n(B,f[N+P],f[N+Q],f[N+S],f[N+T]),n(B,f[O+P],f[O+Q],f[O+S],f[O+T]))*ee|0,X=n(z,n(B,f[L+P+1],f[L+Q+1],f[L+S+1],f[L+T+1]),n(B,f[M+P+1],f[M+Q+1],f[M+S+1],f[M+T+1]),n(B,f[N+P+1],f[N+Q+1],f[N+S+1],f[N+T+1]),n(B,f[O+P+1],f[O+Q+1],f[O+S+1],f[O+T+1]))*ee|0,Y=n(z,n(B,f[L+P+2],f[L+Q+2],f[L+S+2],f[L+T+2]),n(B,f[M+P+2],f[M+Q+2],f[M+S+2],f[M+T+2]),n(B,f[N+P+2],f[N+Q+2],f[N+S+2],f[N+T+2]),n(B,f[O+P+2],f[O+Q+2],f[O+S+2],f[O+T+2]))*ee|0,K[$]=W>=0?256>W?W:255:0,K[$+1]=X>=0?256>X?X:255:0,K[$+2]=Y>=0?256>Y?Y:255:0,K[$+3]=255;else{if(window.Float32Array)R=new Float32Array(_);else{R=[];for(var te=0;_>te;++te)R[te]=0}for(w=0;h>w;w++)for(p=w*l,C=0|p,v=C*U,H=!!((C-(p+l|0))*(h-1-w))<<1,H&&(A=C+1-p,E=p+l-C-1),m=0;g>m;m++,Z+=4)switch(x=m*s,b=0|x,$=v+(b<<2),F=!!((b-(x+s|0))*(g-1-m)),F&&(k=b+1-x,j=x+s-b-1),W=f[Z],X=f[Z+1],Y=f[Z+2],F+H){case 0:R[$]+=W*u,R[$+1]+=X*u,R[$+2]+=Y*u;break;case 1:D=k*l,R[$]+=W*D,R[$+1]+=X*D,R[$+2]+=Y*D,D=j*l,R[$+4]+=W*D,R[$+5]+=X*D,R[$+6]+=Y*D;break;case 2:D=s*A,R[$]+=W*D,R[$+1]+=X*D,R[$+2]+=Y*D,D=s*E,$+=U,R[$]+=W*D,R[$+1]+=X*D,R[$+2]+=Y*D;break;default:D=k*A,R[$]+=W*D,R[$+1]+=X*D,R[$+2]+=Y*D,D=j*A,R[$+4]+=W*D,R[$+5]+=X*D,R[$+6]+=Y*D,D=k*E,$+=U,R[$]+=W*D,R[$+1]+=X*D,R[$+2]+=Y*D,D=j*E,R[$+4]+=W*D,R[$+5]+=X*D,R[$+6]+=Y*D}delete f,G=r(),J=o(G,R)}return G.getContext("2d").putImageData(J,0,0),G}exports?(module&&module.exports&&(exports=module.exports=e),exports.scale=e):this.scale=e}).call(this);