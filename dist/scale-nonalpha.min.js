(function(){function e(e,t,a){function r(){var t;return t="object"==typeof a?a:!a||e.src?d:document.createElement("canvas"),t.width=c,t.height=i,t}function o(e,t){if(t){var a,r=B.getContext("2d").getImageData(0,0,c,i),o=r.data;for(a=0;$>a;a+=4)o[a]=t[a]*_|0,o[a+1]=t[a+1]*_|0,o[a+2]=t[a+2]*_|0,o[a+3]=255;return delete t,r}return e.getContext("2d").getImageData(0,0,c,i)}function n(e,t,a,r,o){return.5*(r-t+(2*t-5*a+4*r-o+(3*(a-r)+o-t)*e)*e)*e+a}var d;e.src?(d=document.createElement("canvas"),d.width=e.naturalWidth,d.height=e.naturalHeight,d.getContext("2d").drawImage(e,0,0)):d=e;var c,i,s,f,l,u=d.width,g=d.height,h=d.getContext("2d").getImageData(0,0,u,g).data;(e.src||!a)&&d.clearRect(0,0,u,g),"object"==typeof t?t.width?(c=t.width+.5|0,i=t.height+.5|0):(c=u*t.scaleX+.5|0,i=g*t.scaleY+.5|0):(c=t*u+.5|0,i=t*g+.5|0),s=c/u,f=i/g,l=s*f;var m,p,w,x,v,y,b,C,I,D,k,j,A,E,F,H,R,W,X,Y,q,z,B,G,J,K,L,M,N,O,P,Q,S,T=c<<2,U=u<<2,V=0,Z=0,$=T*i,_=255.99/255;if(s>1||f>1)for(B=r(),G=o(B),J=G.data,x=0;i>x;x++)for(p=x/f,I=0|p,q=p-I,L=I*U,K=1>I?L:L-U,g-2>I?(M=L+U,N=(I+2)*U):(M=I>g-2?L:L+U,N=M),w=0;c>w;w++,Z+=4)m=w/s,C=0|m,z=m-C,P=C<<2,O=1>C?P:P-4,u-2>C?(Q=P+4,S=P+8):(Q=C>u-2?P:P+4,S=Q),W=n(q,n(z,h[K+O],h[K+P],h[K+Q],h[K+S]),n(z,h[L+O],h[L+P],h[L+Q],h[L+S]),n(z,h[M+O],h[M+P],h[M+Q],h[M+S]),n(z,h[N+O],h[N+P],h[N+Q],h[N+S]))*_|0,X=n(q,n(z,h[K+O+1],h[K+P+1],h[K+Q+1],h[K+S+1]),n(z,h[L+O+1],h[L+P+1],h[L+Q+1],h[L+S+1]),n(z,h[M+O+1],h[M+P+1],h[M+Q+1],h[M+S+1]),n(z,h[N+O+1],h[N+P+1],h[N+Q+1],h[N+S+1]))*_|0,Y=n(q,n(z,h[K+O+2],h[K+P+2],h[K+Q+2],h[K+S+2]),n(z,h[L+O+2],h[L+P+2],h[L+Q+2],h[L+S+2]),n(z,h[M+O+2],h[M+P+2],h[M+Q+2],h[M+S+2]),n(z,h[N+O+2],h[N+P+2],h[N+Q+2],h[N+S+2]))*_|0,J[Z]=W>=0?256>W?W:255:0,J[Z+1]=X>=0?256>X?X:255:0,J[Z+2]=Y>=0?256>Y?Y:255:0,J[Z+3]=255;else{if(window.Float32Array)R=new Float32Array($);else{R=[];for(var ee=0;$>ee;++ee)R[ee]=0}for(p=0;g>p;p++)for(x=p*f,b=0|x,v=b*T,H=!!((b-(x+f|0))*(g-1-p))<<1,H&&(A=b+1-x,E=x+f-b-1),m=0;u>m;m++,V+=4)switch(w=m*s,y=0|w,Z=v+(y<<2),F=!!((y-(w+s|0))*(u-1-m)),F&&(k=y+1-w,j=w+s-y-1),W=h[V],X=h[V+1],Y=h[V+2],F+H){case 0:R[Z]+=W*l,R[Z+1]+=X*l,R[Z+2]+=Y*l;break;case 1:D=k*f,R[Z]+=W*D,R[Z+1]+=X*D,R[Z+2]+=Y*D,D=j*f,R[Z+4]+=W*D,R[Z+5]+=X*D,R[Z+6]+=Y*D;break;case 2:D=s*A,R[Z]+=W*D,R[Z+1]+=X*D,R[Z+2]+=Y*D,D=s*E,Z+=T,R[Z]+=W*D,R[Z+1]+=X*D,R[Z+2]+=Y*D;break;default:D=k*A,R[Z]+=W*D,R[Z+1]+=X*D,R[Z+2]+=Y*D,D=j*A,R[Z+4]+=W*D,R[Z+5]+=X*D,R[Z+6]+=Y*D,D=k*E,Z+=T,R[Z]+=W*D,R[Z+1]+=X*D,R[Z+2]+=Y*D,D=j*E,R[Z+4]+=W*D,R[Z+5]+=X*D,R[Z+6]+=Y*D}delete h,B=r(),G=o(B,R)}return B.getContext("2d").putImageData(G,0,0),B}"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=e),exports.scale=e):this.scale=e}).call(this);