(function(){function e(e,a,r,n){function i(){q="object"==typeof r?r:a.src||n?s:document.createElement("canvas"),q.width=f,q.height=d,z=q.getContext("2d")}function o(e){if(e){var t,a=z.getImageData(0,0,f,d),r=a.data;for(t=0;_>t;t+=4)r[t]=e[t]*ee|0,r[t+1]=e[t+1]*ee|0,r[t+2]=e[t+2]*ee|0,r[t+3]=255;return delete e,a}return z.getImageData(0,0,f,d)}function c(e,t,a,r,n){return.5*(r-t+(2*t-5*a+4*r-n+(3*(a-r)+n-t)*e)*e)*e+a}a||(a=e.input,r=e.output,n=e.inputRemovable,e.scale&&(e=e.scale));var s,u;a.src?(s=document.createElement("canvas"),s.width=a.naturalWidth,s.height=a.naturalHeight):s=a,u=s.getContext("2d"),a.src&&u.drawImage(a,0,0);var f,d,l=s.width,g=s.height,h=u.getImageData(0,0,l,g).data;if(!l||!g)return!1;(a.src||n)&&s.clearRect(0,0,l,g),"object"==typeof e?e.width?(f=e.width+.5|0,d=e.height+.5|0):(f=l*e.scaleX+.5|0,d=g*e.scaleY+.5|0):(f=e*l+.5|0,d=e*g+.5|0);var p,m,w,v,x,y,b,D,I,j,R,k,A,C,E,F,L,U,H,W,X,Y,q,z,B,G,J,K,M,N,O,P,Q,S,T=f<<2,V=l<<2,Z=0,$=0,_=T*d,ee=255.99/255,te=f/l,ae=d/g,re=te*ae;if(te>1||ae>1)for(i(),B=o(),G=B.data,v=0;d>v;v++)for(m=v/ae,I=0|m,X=m-I,K=I*V,J=1>I?K:K-V,g-2>I?(M=K+V,N=(I+2)*V):M=N=I>g-2?K:K+V,w=0;f>w;w++,$+=4)p=w/te,D=0|p,Y=p-D,P=D<<2,O=1>D?P:P-4,l-2>D?(Q=P+4,S=P+8):Q=S=D>l-2?P:P+4,U=c(X,c(Y,h[J+O],h[J+P],h[J+Q],h[J+S]),c(Y,h[K+O],h[K+P],h[K+Q],h[K+S]),c(Y,h[M+O],h[M+P],h[M+Q],h[M+S]),c(Y,h[N+O],h[N+P],h[N+Q],h[N+S]))*ee|0,++O,++P,++Q,++S,H=c(X,c(Y,h[J+O],h[J+P],h[J+Q],h[J+S]),c(Y,h[K+O],h[K+P],h[K+Q],h[K+S]),c(Y,h[M+O],h[M+P],h[M+Q],h[M+S]),c(Y,h[N+O],h[N+P],h[N+Q],h[N+S]))*ee|0,++O,++P,++Q,++S,W=c(X,c(Y,h[J+O],h[J+P],h[J+Q],h[J+S]),c(Y,h[K+O],h[K+P],h[K+Q],h[K+S]),c(Y,h[M+O],h[M+P],h[M+Q],h[M+S]),c(Y,h[N+O],h[N+P],h[N+Q],h[N+S]))*ee|0,G[$]=U>=0?256>U?U:255:0,G[$+1]=H>=0?256>H?H:255:0,G[$+2]=W>=0?256>W?W:255:0,G[$+3]=255;else{if(t.Float32Array)L=new Float32Array(_);else for(L=[],$=0;_>$;++$)L[$]=0;for(m=0;g>m;m++)for(v=m*ae,b=0|v,x=b*T,F=!!((b-(v+ae|0))*(g-1-m))<<1,F&&(A=b+1-v,C=v+ae-b-1),p=0;l>p;p++,Z+=4)switch(w=p*te,y=0|w,$=x+(y<<2),E=!!((y-(w+te|0))*(l-1-p)),E&&(R=y+1-w,k=w+te-y-1),U=h[Z],H=h[Z+1],W=h[Z+2],E+F){case 0:L[$]+=U*re,L[$+1]+=H*re,L[$+2]+=W*re;break;case 1:j=R*ae,L[$]+=U*j,L[$+1]+=H*j,L[$+2]+=W*j,j=k*ae,L[$+4]+=U*j,L[$+5]+=H*j,L[$+6]+=W*j;break;case 2:j=te*A,L[$]+=U*j,L[$+1]+=H*j,L[$+2]+=W*j,j=te*C,$+=T,L[$]+=U*j,L[$+1]+=H*j,L[$+2]+=W*j;break;default:j=R*A,L[$]+=U*j,L[$+1]+=H*j,L[$+2]+=W*j,j=k*A,L[$+4]+=U*j,L[$+5]+=H*j,L[$+6]+=W*j,j=R*C,$+=T,L[$]+=U*j,L[$+1]+=H*j,L[$+2]+=W*j,j=k*C,L[$+4]+=U*j,L[$+5]+=H*j,L[$+6]+=W*j}delete h,i(),B=o(L)}if(z.putImageData(B,0,0),"string"==typeof r){if("png"===r||"jpeg"===r){var ne;return ne=n&&a.src?a:new Image,ne.width=f,ne.height=d,ne.src=q.toDataURL("image/"+r,1),ne}if("png-src"===r||"jpeg-src"===r)return q.toDataURL("image/"+r.split("-")[0],1)}return q}var t=this;"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=e),exports.scale=e):t.scale=e}).call(this);