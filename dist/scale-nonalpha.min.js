function scale(e,t,a){function r(){var t;return t="object"==typeof a?a:!a||e.src?o:document.createElement("canvas"),t.width=d,t.height=i,t}function n(e,t){if(t){var a,r=G.getContext("2d").getImageData(0,0,d,i),n=r.data;for(a=0;_>a;a+=4)n[a]=t[a]*ee|0,n[a+1]=t[a+1]*ee|0,n[a+2]=t[a+2]*ee|0,n[a+3]=255;return delete t,r}return e.getContext("2d").getImageData(0,0,d,i)}function c(e,t,a,r,n){return.5*(r-t+(2*t-5*a+4*r-n+(3*(a-r)+n-t)*e)*e)*e+a}var o;e.src?(o=document.createElement("canvas"),o.width=e.naturalWidth,o.height=e.naturalHeight,o.getContext("2d").drawImage(e,0,0)):o=e;var d,i,g,f,h,l=o.width,u=o.height,s=o.getContext("2d").getImageData(0,0,l,u).data;(e.src||!a)&&o.clearRect(0,0,l,u),"object"==typeof t?t.width?(d=t.width+.5|0,i=t.height+.5|0):(d=l*t.scaleX+.5|0,i=u*t.scaleY+.5|0):(d=t*l+.5|0,i=t*u+.5|0),g=d/l,f=i/u,h=g*f;var w,m,v,b,x,C,I,y,D,k,p,j,A,E,F,H,R,W,X,Y,q,z,B,G,J,K,L,M,N,O,P,Q,S,T,U=d<<2,V=l<<2,Z=0,$=0,_=U*i,ee=255.99/255;if(g>1||f>1)for(G=r(),J=n(G),K=J.data,b=0;i>b;b++)for(m=b/f,D=0|m,z=m-D,M=D*V,L=1>D?M:M-V,u-2>D?(N=M+V,O=(D+2)*V):(N=D>u-2?M:M+V,O=N),v=0;d>v;v++,$+=4)w=v/g,y=0|w,B=w-y,Q=q=y<<2,P=1>y?Q:q-4,l-2>y?(S=q+4,T=q+8):(S=y>l-2?Q:q+4,T=S),W=c(z,c(B,s[L+P],s[L+Q],s[L+S],s[L+T]),c(B,s[M+P],s[M+Q],s[M+S],s[M+T]),c(B,s[N+P],s[N+Q],s[N+S],s[N+T]),c(B,s[O+P],s[O+Q],s[O+S],s[O+T]))*ee|0,X=c(z,c(B,s[L+P+1],s[L+Q+1],s[L+S+1],s[L+T+1]),c(B,s[M+P+1],s[M+Q+1],s[M+S+1],s[M+T+1]),c(B,s[N+P+1],s[N+Q+1],s[N+S+1],s[N+T+1]),c(B,s[O+P+1],s[O+Q+1],s[O+S+1],s[O+T+1]))*ee|0,Y=c(z,c(B,s[L+P+2],s[L+Q+2],s[L+S+2],s[L+T+2]),c(B,s[M+P+2],s[M+Q+2],s[M+S+2],s[M+T+2]),c(B,s[N+P+2],s[N+Q+2],s[N+S+2],s[N+T+2]),c(B,s[O+P+2],s[O+Q+2],s[O+S+2],s[O+T+2]))*ee|0,K[$]=W>=0?256>W?W:255:0,K[$+1]=X>=0?256>X?X:255:0,K[$+2]=Y>=0?256>Y?Y:255:0,K[$+3]=255;else{if(window.Float32Array)R=new Float32Array(_);else{R=[];for(var te=0;_>te;++te)R[te]=0}for(m=0;u>m;m++)for(b=m*f,I=0|b,x=I*U,H=!!((I-(b+f|0))*(u-1-m))<<1,H&&(A=I+1-b,E=b+f-I-1),w=0;l>w;w++,Z+=4)switch(v=w*g,C=0|v,$=x+(C<<2),F=!!((C-(v+g|0))*(l-1-w)),F&&(p=C+1-v,j=v+g-C-1),W=s[Z],X=s[Z+1],Y=s[Z+2],F+H){case 0:R[$]+=W*h,R[$+1]+=X*h,R[$+2]+=Y*h;break;case 1:k=p*f,R[$]+=W*k,R[$+1]+=X*k,R[$+2]+=Y*k,k=j*f,R[$+4]+=W*k,R[$+5]+=X*k,R[$+6]+=Y*k;break;case 2:k=g*A,R[$]+=W*k,R[$+1]+=X*k,R[$+2]+=Y*k,k=g*E,$+=U,R[$]+=W*k,R[$+1]+=X*k,R[$+2]+=Y*k;break;default:k=p*A,R[$]+=W*k,R[$+1]+=X*k,R[$+2]+=Y*k,k=j*A,R[$+4]+=W*k,R[$+5]+=X*k,R[$+6]+=Y*k,k=p*E,$+=U,R[$]+=W*k,R[$+1]+=X*k,R[$+2]+=Y*k,k=j*E,R[$+4]+=W*k,R[$+5]+=X*k,R[$+6]+=Y*k}delete s,G=r(),J=n(G,R)}return G.getContext("2d").putImageData(J,0,0),G}