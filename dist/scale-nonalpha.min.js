(function(){function e(e,a,r,n){function o(){var e;return e="object"==typeof r?r:a.src||n?s:document.createElement("canvas"),e.width=d,e.height=u,e}function i(e){if(e){var t,a=Y.getContext("2d").getImageData(0,0,d,u),r=a.data;for(t=0;Z>t;t+=4)r[t]=e[t]*$|0,r[t+1]=e[t+1]*$|0,r[t+2]=e[t+2]*$|0,r[t+3]=255;return delete e,a}return Y.getContext("2d").getImageData(0,0,d,u)}function c(e,t,a,r,n){return.5*(r-t+(2*t-5*a+4*r-n+(3*(a-r)+n-t)*e)*e)*e+a}a||(a=e.input,r=e.output,n=e.inputRemovable,e.scale&&(e=e.scale));var s;a.src?(s=document.createElement("canvas"),s.width=a.naturalWidth,s.height=a.naturalHeight,s.getContext("2d").drawImage(a,0,0)):s=a;var d,u,g=s.width,f=s.height,l=s.getContext("2d").getImageData(0,0,g,f).data;if(!g||!f)return!1;(a.src||n)&&s.clearRect(0,0,g,f),"object"==typeof e?e.width?(d=e.width+.5|0,u=e.height+.5|0):(d=g*e.scaleX+.5|0,u=f*e.scaleY+.5|0):(d=e*g+.5|0,u=e*f+.5|0);var h,p,m,v,w,x,y,b,D,I,C,j,R,k,A,E,F,L,U,H,W,X,Y,q,z,B,G,J,K,M,N,O,P,Q=d<<2,S=g<<2,T=0,V=0,Z=Q*u,$=255.99/255,_=d/g,ee=u/f,te=_*ee;if(_>1||ee>1)for(Y=o(),q=i(),z=q.data,v=0;u>v;v++)for(p=v/ee,D=0|p,W=p-D,G=D*S,B=1>D?G:G-S,f-2>D?(J=G+S,K=(D+2)*S):(J=D>f-2?G:G+S,K=J),m=0;d>m;m++,V+=4)h=m/_,b=0|h,X=h-b,N=b<<2,M=1>b?N:N-4,g-2>b?(O=N+4,P=N+8):(O=b>g-2?N:N+4,P=O),L=c(W,c(X,l[B+M],l[B+N],l[B+O],l[B+P]),c(X,l[G+M],l[G+N],l[G+O],l[G+P]),c(X,l[J+M],l[J+N],l[J+O],l[J+P]),c(X,l[K+M],l[K+N],l[K+O],l[K+P]))*$|0,U=c(W,c(X,l[B+M+1],l[B+N+1],l[B+O+1],l[B+P+1]),c(X,l[G+M+1],l[G+N+1],l[G+O+1],l[G+P+1]),c(X,l[J+M+1],l[J+N+1],l[J+O+1],l[J+P+1]),c(X,l[K+M+1],l[K+N+1],l[K+O+1],l[K+P+1]))*$|0,H=c(W,c(X,l[B+M+2],l[B+N+2],l[B+O+2],l[B+P+2]),c(X,l[G+M+2],l[G+N+2],l[G+O+2],l[G+P+2]),c(X,l[J+M+2],l[J+N+2],l[J+O+2],l[J+P+2]),c(X,l[K+M+2],l[K+N+2],l[K+O+2],l[K+P+2]))*$|0,z[V]=L>=0?256>L?L:255:0,z[V+1]=U>=0?256>U?U:255:0,z[V+2]=H>=0?256>H?H:255:0,z[V+3]=255;else{if(t.Float32Array)F=new Float32Array(Z);else{F=[];for(var ae=0;Z>ae;++ae)F[ae]=0}for(p=0;f>p;p++)for(v=p*ee,y=0|v,w=y*Q,E=!!((y-(v+ee|0))*(f-1-p))<<1,E&&(R=y+1-v,k=v+ee-y-1),h=0;g>h;h++,T+=4)switch(m=h*_,x=0|m,V=w+(x<<2),A=!!((x-(m+_|0))*(g-1-h)),A&&(C=x+1-m,j=m+_-x-1),L=l[T],U=l[T+1],H=l[T+2],A+E){case 0:F[V]+=L*te,F[V+1]+=U*te,F[V+2]+=H*te;break;case 1:I=C*ee,F[V]+=L*I,F[V+1]+=U*I,F[V+2]+=H*I,I=j*ee,F[V+4]+=L*I,F[V+5]+=U*I,F[V+6]+=H*I;break;case 2:I=_*R,F[V]+=L*I,F[V+1]+=U*I,F[V+2]+=H*I,I=_*k,V+=Q,F[V]+=L*I,F[V+1]+=U*I,F[V+2]+=H*I;break;default:I=C*R,F[V]+=L*I,F[V+1]+=U*I,F[V+2]+=H*I,I=j*R,F[V+4]+=L*I,F[V+5]+=U*I,F[V+6]+=H*I,I=C*k,V+=Q,F[V]+=L*I,F[V+1]+=U*I,F[V+2]+=H*I,I=j*k,F[V+4]+=L*I,F[V+5]+=U*I,F[V+6]+=H*I}delete l,Y=o(),q=i(F)}if(Y.getContext("2d").putImageData(q,0,0),"string"==typeof r){if("png"===r||"jpeg"===r){var re;return re=n&&a.src?a:new Image,re.width=d,re.height=u,re.src=Y.toDataURL("image/"+r,1),re}if("png-src"===r||"jpeg-src"===r)return Y.toDataURL("image/"+r.split("-")[0],1)}return Y}var t=this;"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=e),exports.scale=e):t.scale=e}).call(this);