(function(){function e(e,a,r,n){function o(){var e;return e="object"==typeof r?r:a.src||n?s:document.createElement("canvas"),e.width=d,e.height=f,e}function i(e){if(e){var t,a=q.getContext("2d").getImageData(0,0,d,f),r=a.data;for(t=0;$>t;t+=4)r[t]=e[t]*_|0,r[t+1]=e[t+1]*_|0,r[t+2]=e[t+2]*_|0,r[t+3]=255;return delete e,a}return q.getContext("2d").getImageData(0,0,d,f)}function c(e,t,a,r,n){return.5*(r-t+(2*t-5*a+4*r-n+(3*(a-r)+n-t)*e)*e)*e+a}a||(a=e.input,r=e.output,n=e.inputRemovable,e.scale&&(e=e.scale));var s,u;a.src&&(s=document.createElement("canvas"),s.width=a.naturalWidth,s.height=a.naturalHeight),u=s.getContext("2d"),a.src&&u.drawImage(a,0,0);var d,f,g=s.width,l=s.height,h=u.getImageData(0,0,g,l).data;if(!g||!l)return!1;(a.src||n)&&s.clearRect(0,0,g,l),"object"==typeof e?e.width?(d=e.width+.5|0,f=e.height+.5|0):(d=g*e.scaleX+.5|0,f=l*e.scaleY+.5|0):(d=e*g+.5|0,f=e*l+.5|0);var p,m,v,w,x,y,b,D,I,j,C,R,k,A,E,F,L,U,H,W,X,Y,q,z,B,G,J,K,M,N,O,P,Q,S=d<<2,T=g<<2,V=0,Z=0,$=S*f,_=255.99/255,ee=d/g,te=f/l,ae=ee*te;if(ee>1||te>1)for(q=o(),z=i(),B=z.data,w=0;f>w;w++)for(m=w/te,I=0|m,X=m-I,J=I*T,G=1>I?J:J-T,l-2>I?(K=J+T,M=(I+2)*T):K=M=I>l-2?J:J+T,v=0;d>v;v++,Z+=4)p=v/ee,D=0|p,Y=p-D,O=D<<2,N=1>D?O:O-4,g-2>D?(P=O+4,Q=O+8):P=Q=D>g-2?O:O+4,U=c(X,c(Y,h[G+N],h[G+O],h[G+P],h[G+Q]),c(Y,h[J+N],h[J+O],h[J+P],h[J+Q]),c(Y,h[K+N],h[K+O],h[K+P],h[K+Q]),c(Y,h[M+N],h[M+O],h[M+P],h[M+Q]))*_|0,++N,++O,++P,++Q,H=c(X,c(Y,h[G+N],h[G+O],h[G+P],h[G+Q]),c(Y,h[J+N],h[J+O],h[J+P],h[J+Q]),c(Y,h[K+N],h[K+O],h[K+P],h[K+Q]),c(Y,h[M+N],h[M+O],h[M+P],h[M+Q]))*_|0,++N,++O,++P,++Q,W=c(X,c(Y,h[G+N],h[G+O],h[G+P],h[G+Q]),c(Y,h[J+N],h[J+O],h[J+P],h[J+Q]),c(Y,h[K+N],h[K+O],h[K+P],h[K+Q]),c(Y,h[M+N],h[M+O],h[M+P],h[M+Q]))*_|0,B[Z]=U>=0?256>U?U:255:0,B[Z+1]=H>=0?256>H?H:255:0,B[Z+2]=W>=0?256>W?W:255:0,B[Z+3]=255;else{if(t.Float32Array)L=new Float32Array($);else{L=[];for(var re=0;$>re;++re)L[re]=0}for(m=0;l>m;m++)for(w=m*te,b=0|w,x=b*S,F=!!((b-(w+te|0))*(l-1-m))<<1,F&&(k=b+1-w,A=w+te-b-1),p=0;g>p;p++,V+=4)switch(v=p*ee,y=0|v,Z=x+(y<<2),E=!!((y-(v+ee|0))*(g-1-p)),E&&(C=y+1-v,R=v+ee-y-1),U=h[V],H=h[V+1],W=h[V+2],E+F){case 0:L[Z]+=U*ae,L[Z+1]+=H*ae,L[Z+2]+=W*ae;break;case 1:j=C*te,L[Z]+=U*j,L[Z+1]+=H*j,L[Z+2]+=W*j,j=R*te,L[Z+4]+=U*j,L[Z+5]+=H*j,L[Z+6]+=W*j;break;case 2:j=ee*k,L[Z]+=U*j,L[Z+1]+=H*j,L[Z+2]+=W*j,j=ee*A,Z+=S,L[Z]+=U*j,L[Z+1]+=H*j,L[Z+2]+=W*j;break;default:j=C*k,L[Z]+=U*j,L[Z+1]+=H*j,L[Z+2]+=W*j,j=R*k,L[Z+4]+=U*j,L[Z+5]+=H*j,L[Z+6]+=W*j,j=C*A,Z+=S,L[Z]+=U*j,L[Z+1]+=H*j,L[Z+2]+=W*j,j=R*A,L[Z+4]+=U*j,L[Z+5]+=H*j,L[Z+6]+=W*j}delete h,q=o(),z=i(L)}if(q.getContext("2d").putImageData(z,0,0),"string"==typeof r){if("png"===r||"jpeg"===r){var ne;return ne=n&&a.src?a:new Image,ne.width=d,ne.height=f,ne.src=q.toDataURL("image/"+r,1),ne}if("png-src"===r||"jpeg-src"===r)return q.toDataURL("image/"+r.split("-")[0],1)}return q}var t=this;"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=e),exports.scale=e):t.scale=e}).call(this);